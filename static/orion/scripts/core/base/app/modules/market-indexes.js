/*! updated; 11-06-2020 01:18 AM **/


Modulr.define("core.base:modules/market-indexes",["require","jquery","lodash","utils/environment","core.plugins:StockTickerData","core.plugins:CommaVal","core.plugins:MarketFutures"],function(require,$,_,Env){var StockTicker=require("core.plugins:StockTickerData"),CommaVal=require("core.plugins:CommaVal"),MarketsFutures=require("core.plugins:MarketFutures");return new function(){if("foxbusiness"!==Env.getSiteId())return!1;var parent=$(".collection-market-indexes");if(0===parent.length)return!1;var res,singleStock=parent.find(".index"),content=parent.find(".content");if(MarketsFutures.isFutures())return parent.find(".heading h2").text("Market Futures"),void MarketsFutures.getData(function(data){for(var val,item,info,updown,html,norm=normalize(data),markup=[],i=0;i<norm.length;i++)item=norm[i],void 0,info=item.info,updown=function(dir){return dir?"is-"+dir:""}((val=info.pct,/^\+/.test(val)?"up":/^\-/.test(val)?"down":null)),html='<div class="index '+updown+'" data-futures-symbol="'+item.quote+'">                        <div class="index-heading">                            <div class="ticker">'+item.name+'</div>                            <div class="ticker-type">('+item.quote+')</div>                        </div>                        <div class="info">                            <div class="value">'+info.val+'</div>                            <div class="change">                                <span class="change-value">'+info.pts+'</span> <span class="change-percent">('+info.pct+")</span>                            </div>                        </div>                    </div>",markup.push(html);content.find("> .quote-lookup:first").nextAll().remove(),content.append(markup.join(""))});function normalize(data){function set(item){function idx(val){var name=(item.name||"").replace(/\&amp;/g,"&").toUpperCase();return val=(val||"").replace(/\&amp;/g,"&").toUpperCase(),-1<name.indexOf(val)}idx("E-MINI S&P 500")?arr.push({order:3,name:"S&P 500 FUTURES",quote:"INX",info:item}):idx("E-MINI NASDAQ")?arr.push({order:2,name:"NASDAQ FUTURES",quote:"I:COMPX",info:item}):idx("E-MINI DOW")&&arr.push({order:1,name:"DOW JONES FUTURES",quote:"I:DJI",info:item})}for(var arr=[],i=0;i<data.length;i++)set(data[i]);return arr.sort(function(a,b){return a.order<b.order?-1:1}),arr}if($('<p class="dek">Quotes displayed in real-time</p>').insertAfter(parent.find(".heading:first")),0===singleStock.length){var domain="foxbusinessp.factsetdigitalsolutions.com";!(!Env.isStaging()&&!Env.isProd())||(domain="foxbusinessp.ppe.factsetdigitalsolutions.com");var iframeUrl="https://"+domain+"/markets/marketView";content.append('<iframe title="Market Index Charts" id="market-index-charts" src="'+iframeUrl+'" height="352"></iframe>')}else{var target=$(".index[data-ticker]");if(0===target.length)return;var stockList=(res=[],target.each(function(){res.push($(this).attr("data-ticker"))}),res);StockTicker.init(stockList,function(data){target.each(function(){var el=$(this),symbol=el.attr("data-ticker"),id=el.attr("data-ticker-id")||symbol,info=data[id];if(!info)return console.log("No Stock Symbol Data (indexes) for:",symbol);el.addClass("is-"+info.marketDirection),el.find(".ticker").text(symbol),el.find(".value").text(CommaVal(info.currentPrice,2)),el.find(".change").each(function(){var ch=$(this);0<ch.find("> .change-value").length?(ch.find(".change-value").text(info.netChange),ch.find(".change-percent").text("("+info.percentChange+")")):ch.text(info.netChange+" ("+info.percentChange+")")})})})}}});