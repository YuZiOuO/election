/*! updated; 11-06-2020 01:18 AM **/


Modulr.define("core.base:modules/breaking-news",["require","jquery","lodash","utils/environment","utils/localStorage","utils/sessionStorage"],function(require,$,_){var Environment=require("utils/environment"),LocalStorage=require("utils/localStorage"),SessionStorage=require("utils/sessionStorage"),isLocalOK=LocalStorage.isAvailable();return new function(){var CONFIG={auto_poll:!0,poll_interval_in_min:2},ENABLED=!0,Proto=this,template=!1,showing=!1,location=-1<window.location.hostname.indexOf("foxbusiness")?"foxbusiness":"foxnews",url=function(domain){var url;if("foxbusiness"===domain){var ENV=Environment.isStaging()?"stage-fb-":Environment.isProd()?"":"dev-fb-",path=Environment.isProd()?"prod":ENV.replace("-fb-","");url="https://"+ENV+"api.foxbusiness.com/cm/"+path+"/search?type=layout&size=1&subtype=breakingNews&env=production&cb="}else{var prefix=function(forceDev){var isProd=!(!Environment.isProd()&&!Environment.isStaging());return forceDev||!isProd?"dev.api.":"www."}(-1<window.location.search.indexOf("_breaking_feed=dev"));url="https://"+prefix+location+".com/js/breakingNews.js?cb="}return url}(location),container=$(".post-content");function cacheBuster(freq){freq=freq||!1;var date=new Date,str=date.getFullYear().toString()+(date.getMonth()+1).toString()+date.getDate().toString(),hr=date.getHours()+1,min=date.getMinutes();return str+=hr.toString()+(freq&&!isNaN(freq)?Math.floor(min/parseFloat(freq)).toString():"")}function isArray(val){return"[object Array]"===Object.prototype.toString.call(val)}Proto.disable=function(){ENABLED=!1,$(".alert-container").remove()},Proto.enable=function(){ENABLED=!0},Proto.renderAlert=function(data){if(ENABLED){var compiled=_.template(template);0<container.length&&(container.html(compiled(data)),function(target,info){window.leapmetrics=window.leapmetrics||[],window.leapmetrics.push(function(Leap){if("function"==typeof Leap.pageEvent)return Leap.pageEvent("breakingNewsAlert",{info:info,target:target});var onBanner,onClose,sId="_breaking_news_alert",currVal=info.title,stored=SessionStorage.get(sId);function impression(){SessionStorage.set(sId,currVal),Leap.track("banner:impression",getDataInfo())}function track(type){var dataInfo=getDataInfo();dataInfo.page_action_type=type||"clicked",Leap.track("banner:action",dataInfo)}function getDataInfo(){return{page_message_title:info.displayname||info.eyebrow,page_message_text:info.title,page_message_type:info.type||"n/a",page_message_id:info.id||info.tracking||info.type}}stored?currVal!==stored&&impression():impression(),onClose=onBanner=!1,target.find("a").hover(function(){$(this).hasClass("close")?onClose=!0:onBanner=!0},function(){onClose=onBanner=!1}),$(document).on("click",function(){onClose?track("close"):onBanner&&track()})})}(container,data),$(container).find(".close").click(function(evt){evt.preventDefault(),$(this).closest(".alert-banner").removeClass("slide-in").addClass("slide-out"),showing=!1,isLocalOK&&localStorage.setItem("FNBNABURL",data.link)}),$(container).find(".alert-title > a").click(function(evt){isLocalOK&&localStorage.setItem("FNBNABURL",data.link),$(this).closest(".alert-banner").removeClass("slide-in").addClass("slide-out"),showing=!1}),$(".alert-banner.slide-in").one("webkitAnimationEnd mozAnimationEnd MSAnimationEnd oanimationend animationend",function(){$(this).removeClass("slide-in"),showing=!0}))}},Proto.poll=function(){ENABLED&&!1===showing&&("foxbusiness"===location?$.ajax({url:url+cacheBuster(2),cache:!0,async:!0}).done(function(data){!function(data){if(data.results&&isArray(data.results)&&0<data.results.length){var previousURL=!1,item=data.results[0],itemEXT=item["main-content"][0],currURL=item&&itemEXT&&item["main-content"][0].model?item["main-content"][0].model.url:"";if(isLocalOK&&(previousURL=localStorage.getItem("FNBNABURL")),(!previousURL||previousURL!==currURL)&&0<currURL.length){if("BreakingNews"===itemEXT.model.bannerType)item.classname="is-breaking",item.displayname="Breaking News",item.tracking="hp1bbkn";else switch(item.classname="is-programming",itemEXT.model.bannerType){case"ProgrammingAlert":item.displayname="Programming Alert",item.tracking="hp1bprog";break;case"LiveCoverage":item.displayname="Live Coverage",item.tracking="hp1blc";break;case"DevelopingStory":item.displayname="Developing Story",item.tracking="hp1bds";break;case"WatchLive":item.displayname="Watch Live",item.tracking="hp1bwn";break;default:item.displayname="",item.tracking="hp1bblank",item.classname="is-programming"}var vals={title:itemEXT.model.headline,link:currURL,type:itemEXT.component,helpertext:"hide"};(item=_.merge(item,vals)).eyebrow&&(item.displayname=item.eyebrow),Proto.renderAlert(item)}}}(data)}):$.ajax({url:url+cacheBuster(2),cache:!0,dataType:"script",async:!0}))},Proto.init=function(configuration){ENABLED&&require(["core.templates:controls/api"],function(Template){!function(Template){Template.get("/static/orion/scripts/core/base/app/templates/breaking.news.html",function(response){if(response&&(template=response,configuration&&(CONFIG=_.merge(CONFIG,configuration)),window.fox_header_breakingnews=function(data){if(data&&isArray(data)&&0<data.length&&data[0].type){var previousURL=!1,item=data[0];if(isLocalOK&&(previousURL=localStorage.getItem("FNBNABURL")),!previousURL||previousURL!==item.link){if(item.helpertext="","BreakingNews"===item.type)item.classname="is-breaking",item.displayname="Breaking News",item.tracking="hp1bbkn";else switch(item.classname="is-programming",item.type){case"ProgrammingAlert":item.displayname="Programming Alert",item.tracking="hp1bprog";break;case"LiveCoverage":item.displayname="Live Coverage",item.tracking="hp1blc";break;case"DevelopingStory":item.displayname="Developing Story",item.tracking="hp1bds";break;case"WatchLive":item.displayname="Watch Live",item.tracking="hp1bwn";break;case"ShepardSmith":item.displayname="Shepard Smith Reporting",item.tracking="hp1bssr",item.classname="is-show";break;case"ListenNow":item.displayname="Listen Now",item.tracking="hp1bls";break;case"FoxNationAlert":item.displayname="Fox Nation Alert",item.tracking="hp1bnat",item.classname="is-nation";break;default:item.displayname="",item.tracking="hp1bblank",item.classname="is-programming"}item.eyebrow&&(item.displayname=item.eyebrow),Proto.renderAlert(item)}}},0===container.find(".alert-container").length&&container.append('<div class="alert-container"></div>'),container=container.find(".alert-container"),Proto.poll(),CONFIG.auto_poll)){var updateInterval=6e4*CONFIG.poll_interval_in_min;setInterval(function(){Proto.poll()},updateInterval)}})}(Template)})}}});